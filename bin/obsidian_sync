#!/bin/bash

# notify-send "Obsidian" "Comenzando sincronización..."
cd ~/personal/second-brain/ || { zenity --info --text "No se pudo acceder al directorio"; exit 1; }
zenity --progress --title "Obsidian" --text="Syncing notes..." --pulsate --no-cancel &

# Ejecutar git pull y guardar su salida
pull_output=$(git pull origin main 2>&1)
pull_status=$?

# Preparar commit con timestamp
timestamp=$(date "+%Y-%m-%d %H:%M:%S")
git add .
git commit -m "laptop - $timestamp" > /dev/null 2>&1

# Ejecutar git push y guardar su salida
push_output=$(git push origin main 2>&1)
push_status=$?

# Verificar errores
pkill zenity
if [[ $pull_status -ne 0 || $push_status -ne 0 ]]; then
    zenity --info --title "Obsidian" --text "Error while sync"
    exit 1
fi

# Notificación final de éxito
zenity --info --title "Obsidian" --text "Notes synced" &
sleep 1
pkill zenity
