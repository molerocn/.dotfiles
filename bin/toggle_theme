#!/bin/bash

MODE=$1  # Primer argumento: "manual" o "automatic"
CONFIG_FILE="$HOME/.config/alacritty/alacritty.toml"
TMUX_CONFIG_FILE="$HOME/.tmux.conf"

restart_anki() {
    if pgrep -x "anki" > /dev/null; then
        pkill -9 anki
        sleep 1
        anki &
    fi
}

set_light() {
    sed -i 's/github_dark_default/github_light/' "$CONFIG_FILE"
    sed -i 's/#131313/#ECECEC/' "$TMUX_CONFIG_FILE"
    sed -i 's/#D4D4D4/#2B2B2B/' "$TMUX_CONFIG_FILE"
    tmux source ~/.tmux.conf
    gsettings set org.gnome.desktop.interface color-scheme 'prefer-light'
    restart_anki
}

set_dark() {
    sed -i 's/github_light/github_dark_default/' "$CONFIG_FILE"
    sed -i 's/#ECECEC/#131313/' "$TMUX_CONFIG_FILE"
    sed -i 's/#2B2B2B/#D4D4D4/' "$TMUX_CONFIG_FILE"
    tmux source ~/.tmux.conf
    gsettings set org.gnome.desktop.interface color-scheme 'prefer-dark'
    restart_anki
}

current_scheme=$(gsettings get org.gnome.desktop.interface color-scheme)
if [[ "$MODE" == "manual" ]]; then
    if [[ "$current_scheme" == "'prefer-dark'" ]]; then
        set_light
    else
        set_dark
    fi
elif [[ "$MODE" == "automatic" ]]; then
    hour=$(date +%H)
    if (( hour >= 8 && hour < 17 )); then
        if [[ "$current_scheme" == "'prefer-dark'" ]]; then
            set_light
        fi
    else
        if [[ "$current_scheme" == "'prefer-light'" ]]; then
            set_dark
        fi
    fi
else
    echo "Uso: $0 [manual|automatic]"
    exit 1
fi

